---
title: Bot messages with AI-generated content
description: Learn how to add an AI label, sensitivity labels, citations, and feedback buttons to bots with AI-generated content with Teams AI library and Bot Framework SDK.
ms.topic: conceptual
ms.localizationpriority: medium
ms.date: 10/31/2024
---

# Bot messages with AI-generated content

Add AI labels, citations, feedback buttons, and sensitivity labels to your bot’s messages in Microsoft Teams personal chats, group chats, and channels. This ensures that your bot provides a reliable, secure, and interactive experience to your users.

* [AI label](#ai-label) enables users to identify that the message was generated using AI.
* [Citations](#citations) enables users to refer to the source of the bot message through in-text citations and references.
* [Feedback buttons](#feedback-buttons) enables users to provide positive or negative feedback to the bot messages.
* [Sensitivity label](#sensitivity-label) enables users to understand the confidentiality of the bot message.

The following screenshots show how bot messages can be enhanced with AI labels, citations, feedback buttons, and sensitivity labels:

# [Before](#tab/before)

:::image type="content" source="../../assets/images/bots/ai-bot-no-features.png" border="false" alt-text="Screenshot shows a bot message with no AI label, citation, feedback buttons, and sensitivity label.":::

# [After](#tab/after)

:::image type="content" source="../../assets/images/bots/ai-bot-message.png" border="false" alt-text="Screenshot shows a bot message with AI label, citation, feedback buttons, and sensitivity label.":::

---

## AI label

Add an AI label to your bot message to specify that the message is generated by AI. AI bots use Large Language Models (LLMs) that are generally reliable, however, adding an AI label prevents confusion about the source of the information.

:::image type="content" source="../../assets/images/bots/ai-bot-label.png" border="false" alt-text="Screenshot shows an AI label in a bot message.":::

### Add AI label

For a bot built using **Teams AI library**, an AI label is automatically enabled for all AI-powered bot messages in the `ai` module within the `PredictedSayCommand` action. For more information, see [AIEntity interface](https://github.com/microsoft/teams-ai/blob/main/js/packages/teams-ai/src/actions/SayCommand.ts#L15).

If you're using **Microsoft Bot Framework SDK** to build your bot, include `additionalType` under the `entities` array of the `message` entity object. Following is an example code snippet:

```javascript
await context.sendActivity({
  type: ActivityTypes.Message,
  text: `Hey! I'm a friendly AI bot. This message is generated by AI.`,
  entities: [
    {
     type: "https://schema.org/Message",
     "@type": "Message",
     "@context": "https://schema.org",
     additionalType: ["AIGeneratedContent"], // Enables AI label
    }
  ]
});
```

| Property | Type | Required | Description |
|--|--|--|--|
| `additionalType` | Array | Yes | Enables the AI label in the bot message. The only allowed value is `AIGeneratedContent`. |

After an AI label is added, your bot’s message displays an **AI generated** label next to the bot’s name with a hover-over disclaimer stating, **AI-generated content may be incorrect**. The AI label and disclaimer can't be customized for AI-powered bots.

### Error handling

| Error code | Description |
| --- | --- |
| 400 | Multiple root message entities found under `entities` array |
| 400 | Error parsing message entity from `entities` array |

## Citations

It's important to cite the sources of the bot message to help users ask follow-up xstions or conduct independent research. Cite data sources, such as files, messages, emails, and work items, to provide valuable insights to users. Citations are important for bots using techniques such as Retrieval Augmented Generation (RAG).

:::image type="content" source="../../assets/images/bots/ai-bot-inline-citation.png" border="false" alt-text="Screenshot shows an AI bot response with in-text citation.":::

Citations in your bot's message include in-text citations, details of the citation reference, and sensitivity labels for the content referenced.

* **In-text citations** denote the citation numbers added to the bot message in the [#] format, each corresponding to a reference. A citation can be inserted anywhere within the text.
* **Details of the citation reference** include the title, icon, keywords, an abstract, hyperlink, and sensitivity information. References appear as pop-up windows for each in-text citation.
* **Sensitivity labels to citations** indicate the confidentiality of the citation content referenced and aren't added automatically. To add sensitivity labels for citations, see [add sensitivity label](#add-sensitivity-label).

> [!NOTE]
>
> * A maximum of 20 citations are displayed in a message.
> * Adaptive Cards aren't rendered in the citation pop-up window. However, Adaptive Cards can be rendered in the bot's message.

### Add citations

For bots built using **Teams AI library**, citations are added to an AI bot message automatically through `PredictedSayCommand` action. You can also modify the `PredictedSayCommand` action to add citations to your bot message. For more information, see [ClientCitation interface](https://github.com/microsoft/teams-ai/blob/main/js/packages/teams-ai/src/actions/SayCommand.ts#L46).

If you're using **Bot Framework SDK** to build your bot, include `citation` under the `entities` array. Following is an example code snippet:

```javascript
await context.sendActivity({
  type: ActivityTypes.Message,
  text: `Hey I'm a friendly AI bot. This message is generated through AI [1]`, // cite with [1],
  entities: [
  {
    type: "https://schema.org/Message",
    "@type": "Message",
    "@context": "https://schema.org",
    citation: [
    {
      "@type": "Claim",
      position: 1, // Required. Must match the [1] in the text above
      appearance: {
        "@type": "DigitalDocument",
        name: "AI bot", // Title
        url: "https://example.com/claim-1", // Hyperlink on the title
        abstract: "Excerpt description", // Appears in the citation pop-up window
        keywords: ["keyword 1", "keyword 2", "keyword 3"], // Appears in the citation pop-up window
        encodingFormat: "docx",
        },
      },
    ],
  },
],
})
```

| Property | Type | Required | Description |
|--|--|--|--|
| `citation` | Object | Yes | Details of the citation. |
| `citation.@type` | String | Yes | Object of the citation. The only allowed value is `Claim`. |
| `citation.position` | Integer | Yes | Displays the citation number. The values are limited to less than eight. |
| `citation.appearance` | Object | Yes | Information about the appearance of the citation. |
| `citation.appearance.@type` | String | Yes | Object of the citation appearance. The only allowed value is `DigitalDocument`. |
| `citation.appearance.name` | String | Yes | Title of the referenced content. Maximum characters: 80 |
| `citation.appearance.url` | String | No | URL of the referenced content. |
| `citation.appearance.abstract` | String | No | Extract of the referenced content. Maximum characters: 160 |
| `citation.appearance.keywords` | Array | No | Keywords from the referenced content. You can't add more than three keywords. Each keyword can only contain 28 characters. |
| `citation.appearance.encodingFormat` | String | No | Media type of the citation source. It renders the citation icon in the details of the citation reference. |

<br>
<details>
<summary>List of media type values allowed in the `encodingFormat` property</summary>

| Icon | Extension (File format) |
|--|--|
| Microsoft Word | docx, doc, docm, dotx, dot, dotm, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document, application/vnd.openxmlformats-officedocument.wordprocessingml.template, application/vnd.ms-word.document.macroenabled.12, application/vnd.ms-word.template.macroenabled.12 |
| Microsoft Excel | xlsx, xlsb, xls, xlsm, csv, ods, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.openxmlformats-officedocument.spreadsheetml.template, application/vnd.ms-excel.sheet.macroenabled.12, application/vnd.ms-excel.template.macroenabled.12, application/vnd.ms-excel.addin.macroenabled.12, application/vnd.ms-excel.sheet.binary.macroenabled.12 |
| Microsoft PowerPoint | pptx, potm, ppt, pptm, pot, potx, pps, ppsm, ppsx, application/vnd.ms-powerpoint, application/vnd.openxmlformats-officedocument.presentationml.presentation, application/vnd.openxmlformats-officedocument.presentationml.template, application/vnd.openxmlformats-officedocument.presentationml.slideshow, application/vnd.ms-powerpoint.addin.macroenabled.12, application/vnd.ms-powerpoint.presentation.macroenabled.12, application/vnd.ms-powerpoint.template.macroenabled.12, application/vnd.ms-powerpoint.slideshow.macroenabled.12 |
| Microsoft SharePoint | sppage, splist, splistform, splistitem, splistplaylist |
| Microsoft OneNote | note, one, onenote, onepkg, notebk, onetoc2 |
| Microsoft Loop | fluid, loop |
| Microsoft Visio | vsdx, vsdm, vsd |
| Microsoft Whiteboard | whiteboard |
| Source Code | js, cs, html, htm, cmd, c, class, xml, cpp |
| Sketch | sketch |
| Adobe Illustrator | ai, ait, eps |
| Adobe Flash | fla, swf, as |
| Adobe Photoshop | psd, pdd |
| Adobe InDesign | indd, indl, indt, indb |
| Adobe After Effects | aep, aet, aaf, aepx |
| PDF | pdf, application/pdf |
| Text | txt |
| ZIP | zip, rar |
| Image | png, jpg, jpeg, bmp, tiff, tif, image/png, image/jpg, image/jpeg |
| GIF | gif, image/gif |
| Audio | mp3, wav, m4a, wma |
| Video | 3g2, 3gp, 3gpp, asf, avi, m2ts, m4v, mkv, mp4v, mts, ts, mp4, mov, wmv, webm |

</details>

After you enable citations, the bot message includes in-text citations and references. The in-text citations display the reference details when users hover over the citation.

### Error handling

| Error code | Description |
| --- | --- |
| 400 | Multiple root message entities found under `entities` array |
| 400 | Error parsing message entity from `entities` array |
| 400 | Bot message with more than 10 citations |
| 400 | The `appearance` object is empty |
| 400 | Error while parsing citation entity with ID: X |

## Feedback buttons

Feedback buttons in bot messages are crucial for measuring user engagement, identifying errors, and gaining insights into your bot's performance. These insights can lead to targeted and effective enhancements of your bot’s conversational capabilities. Enable feedback buttons to allow users to like or dislike messages and provide detailed feedback.

:::image type="content" source="../../assets/images/bots/bot-feedback-buttons.png" border="false" alt-text="Screenshot shows the feedback buttons in a bot.":::

When the user selects a feedback button, a respective feedback form appears based on the user's selection.

:::image type="content" source="../../assets/images/bots/bot-feedback-form.png" border="false" alt-text="Screenshot shows the feedback form in a bot.":::

Feedback buttons are located at the footer of the bot’s message, and include a 👍 (thumbs up) and a 👎 (thumbs down) button for the user to choose from. You can collect feedback on bot responses from one-on-one and group chats.

### Add feedback buttons

For a bot built using **Teams AI library**, Teams enables feedback buttons to all bot messages when `enable_feedback_loop` is set to `true` in the `ai` module.

```javascript
export const app = new Application<ApplicationTurnState>({
    ai: {
        planner: planner,
        enable_feedback_loop: true
    },
```

For more information, see the [const app variable](https://github.com/microsoft/teams-ai/blob/main/js/samples/04.ai-apps/h.datasource-azureOpenAI/src/app.ts#L42).

After you enable feedback buttons, all SAY commands from the bot have `feedbackLoopEnabled` automatically set to `true` in the `channelData` object.

To enable feedback buttons in a bot built using **Bot Framework SDK**, add a `channelData` object in your bot message and set the value of `feedbackLoopEnabled` to `true`.

```javascript
await context.sendActivity({
  type: ActivityTypes.Message,
  text: `Hey! I'm a friendly AI bot!`,
  channelData: {
    feedbackLoopEnabled: true // Enable feedback buttons
  },
});
```

| Property | Type | Required | Description |
|--|--|--|--|
| `feedbackLoopEnabled` | Boolean | Yes | Enables feedback buttons in the bot's message |

### Handle feedback

The bot receives the user's input, received in the feedback form, through a bot invoke flow.

For a bot built using **Teams AI library**, the bot invoke received is automatically handled. To handle feedback, use the `app.feedbackLoop` method to register a feedback loop handler called when the user provides feedback.

```javascript
app.feedbackLoop(async (context, state, feedbackLoopData) => {
  // custom logic here...
});
```

For more information, see the [asynchronous callback function](https://github.com/microsoft/teams-ai/blob/main/js/samples/04.ai-apps/h.datasource-azureOpenAI/src/app.ts#L95).

For a bot built using **Bot Framework SDK**, you must have an `onInvokeActivity` handler to process the feedback. Ensure that you return a status code 200 with an empty JSON object as a response.

The following code snippet shows how to handle feedback received in a bot invoke and return a response with the status code 200:

```javascript
public async onInvokeActivity(context: TurnContext): Promise<InvokeResponse> {
    try {
      switch (context.activity.name) {
        case "message/submitAction":
           console.log('Your feedback is ' + JSON.stringify(context.activity.value))
           // Your feedback is {"actionName":"feedback","actionValue":{"reaction":"like","feedback":"{\"feedbackText\":\"This is my feedback.\"}"}}
           return CreateInvokeResponse(200, {});
        default:
          return {
            status: 200,
            body: `Unknown invoke activity handled as default- ${context.activity.name}`,
          };
      }
    } catch (err) {
      console.log(`Error in onInvokeActivity: ${err}`);
      return {
        status: 500,
        body: `Invoke activity received- ${context.activity.name}`,
      };
    }
  }

 export const CreateInvokeResponse = (
  status: number,
  body?: unknown
 ): InvokeResponse => {
    return { status, body };
 };
```

It’s important to store feedback after you receive it. Hence, ensure that you store the message IDs and the content of the messages that your bot sends and receives. When your bot receives an invoke containing feedback, match the message ID of the bot’s message with the corresponding feedback.

> [!NOTE]
> Teams neither stores nor processes feedback, nor does it provide an API or a storage mechanism.

If a user uninstalls your bot and still has access to the bot chat, Teams removes the feedback buttons from the bot messages to prevent the user from providing feedback to the bot.

### Error handling

| Error code | Description |
| --- | --- |
| 400 | `message/submitAction` invoke response isn't empty. |

## Sensitivity label

Bot responses might contain information that's confidential or only accessible to certain individuals within the organization. You must add a sensitivity label to help users identify the confidentiality of a message, enabling them to exercise caution when sharing the message.

:::image type="content" source="../../assets/images/bots/ai-bot-sensitivity-label.png" border="false" alt-text="Screenshot shows an AI bot sensitivity label.":::

> [!NOTE]
> Add a sensitivity label to your bot's messages only when they contain sensitive information.

### Add sensitivity label

For bots built using **Teams AI library**, sensitivity labels can be added through `PredictedSayCommand` action. For more information, see [SensitivityUsageInfo interface](https://github.com/microsoft/teams-ai/blob/main/js/packages/teams-ai/src/actions/SayCommand.ts#L107).

For bots built using **Bot Framework SDK**, add a sensitivity label to your bot message by modifying the message to include `usageInfo` in the `entities` object.

The following code snippet shows how to add sensitivity labels to both bot messages and citation reference:

# [Bot message](#tab/botmessage)

```javascript
await context.sendActivity({
  type: ActivityTypes.Message,
  text: `Hey, I'm a friendly AI bot. This message is generated through AI [1]`,
  entities: [
    {
      type: "https://schema.org/Message",
      "@type": "Message",
      "@context": "https://schema.org",
      usageInfo: {
        "@type": "CreativeWork",
        name: "Sensitivity title",
        description: "Sensitivity description",
      },
    },
  ],
});
```

# [Citation reference](#tab/citationref)

```javascript
await context.sendActivity({
  type: ActivityTypes.Message,
  text: `Hey, I'm a friendly AI bot. This message is generated through AI [1]`,
  entities: [
    {
      type: "https://schema.org/Message",
      "@type": "Message",
      "@context": "https://schema.org",
      usageInfo: {
        "@type": "CreativeWork",
        name: "Sensitivity title",
        description: "Sensitivity description",
      },
      citation: [
        {
          "@type": "Claim",
          position: 1,
          appearance: {
            "@type": "DigitalDocument",
            name: "AI bot",
            url: "https://example.com/claim-1",
            usageInfo: {
              "@type": "CreativeWork",
              "@id": "sensitivity1",
              name: "Sensitivity title",
              description: "Sensitivity description",
            },
          },
        },
      ],
    },
  ],
});
```

---

| Property | Type | Required | Description |
|--|--|--|--|
| `usageInfo.@type` | String | Yes | Enables the sensitivity label in the bot message. |
| `citation.usageInfo.@id` | String | Yes | Enables the sensitivity label in the citation reference. It's required when adding sensitivity label to citation reference. |
| `usageInfo.name` | String | Yes | Specifies the title of the sensitivity label. |
| `usageInfo.description` | String | No | Specifies the pop-up window message that appears when a user hovers over the sensitivity label. |

After the sensitivity label is added, your bot message contains a shield icon. Users can hover over the icon to find a disclaimer on the sensitivity of the message.

### Error handling

| Error code | Description |
| --- | --- |
| 400 | Multiple root message entities found under `entities` array |
| 400 | Error parsing message entity from `entities` array |
| 400 | Citation level `usageInfo.@id` value doesn't match the message level `usageInfo.@id` in at least one instance |
| 400 | There are multiple citation-level `usageInfo` properties with the same `@id`, but their `name` and `description` properties are different. |

## Modify `PredictedSayCommand`

For a bot built using Teams AI library, the `PredictedSayCommand` provides control on how AI label, citations, feedback buttons, and sensitivity labels are added to the bot's activity. Following is the code snippet to modify `PredictedSayCommand`:

```JavaScript
app.ai.action<PredictedSayCommand>(AI.SayCommandActionName, async (context, state, data, action) => {
  // custom logic here...
  await context.sendActivity(data.content);
  return "";
});
```

For more information about `PredictedSayCommand`, see [PredictedSayCommand interface](/javascript/api/%40microsoft/teams-ai/predictedsaycommand?view=msteams-client-js-latest&preserve-view=true).

## Code sample

| Sample name | Description | Node.js | C# |
|:--|--|--|
| Teams conversation bot | This sample app displays the AI label, citations, feedback buttons, and sensitivity labels in messages. | [View](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/bot-conversation/nodejs) | |
| TeamsAzureOpenAI | This conversational bot uses Teams AI library and contains the AI label, feedback buttons, sensitivity label, and citations in its generated messages. | | [View](https://github.com/microsoft/teams-ai/tree/main/dotnet/samples/08.datasource.azureopenai) |

## See also

* [Bot activity handlers](../bot-basics.md)
* [Format your bot messages](format-your-bot-messages.md)
* [Get started with Teams AI library](teams-conversational-ai/how-conversation-ai-get-started.md)
